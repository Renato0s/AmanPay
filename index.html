<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AmanPay</title>
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AmanPay">
    <meta name="theme-color" content="#10b981">
    
    <!-- Manifest with strict display: standalone -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"AmanPay Premium","short_name":"AmanPay","start_url":"/","display":"standalone","orientation":"portrait","background_color":"#f8fafc","theme_color":"#10b981","icons":[{"src":"https://img.icons8.com/fluency/240/shield-with-check-mark.png","sizes":"240x240","type":"image/png"}]}'>

    <!-- Icons -->
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/240/shield-with-check-mark.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/240/shield-with-check-mark.png">

    <!-- Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        emerald: { 400: '#34d399', 500: '#10b981', 600: '#059669' },
                        slate: { 850: '#1e293b', 950: '#020617' }
                    },
                    borderRadius: { '4xl': '2rem', '5xl': '3rem' }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --sat: env(safe-area-inset-top);
            --sab: env(safe-area-inset-bottom);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            padding-top: var(--sat);
            padding-bottom: var(--sab);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            overflow-x: hidden;
            background: #f8fafc;
            /* Предотвращает отскок (bounce) на iOS */
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #root {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .dark body { background: #020617; }
        
        .animate-enter { animation: enter 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes enter { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .premium-card {
            background: linear-gradient(135deg, #10b981 0%, #064e3b 100%);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.3);
        }

        .glass-ui {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .dark .glass-ui {
            background: rgba(15, 23, 42, 0.75);
            border-color: rgba(255, 255, 255, 0.05);
        }

        input { font-size: 16px !important; }
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body class="transition-colors duration-500">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, query, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBO9_w8ymwnX6Fje5czL0d3-bxRoa9OpT4",
            authDomain: "amanpay-790fd.firebaseapp.com",
            projectId: "amanpay-790fd",
            storageBucket: "amanpay-790fd.firebasestorage.app",
            messagingSenderId: "720784541108",
            appId: "1:720784541108:web:fa06ff39e7ea57f5ac1ee1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'amanpay-v1';

        window.amanDB = {
            db, auth, appId,
            collections: {
                users: collection(db, 'artifacts', appId, 'public', 'data', 'users'),
                txs: collection(db, 'artifacts', appId, 'public', 'data', 'transactions')
            },
            utils: { doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, query, addDoc, serverTimestamp, signInAnonymously, onAuthStateChanged }
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const formatMoney = (sum) => new Intl.NumberFormat('ru-RU', { 
            style: 'currency', currency: 'KGS', maximumFractionDigits: 0 
        }).format(sum || 0);

        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                if (type === 'receive') {
                    osc.frequency.setValueAtTime(523, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                } else {
                    osc.frequency.setValueAtTime(440, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(220, ctx.currentTime + 0.1);
                }
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.3);
            } catch (e) {}
        };

        const SvgIcon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                sun: <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />,
                moon: <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />,
                back: <path d="M5 12h14M5 12l6 6M5 12l6-6" />,
                user: <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" />,
                logout: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" />,
                search: <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />,
                wallet: <path d="M17 8C19.2091 8 21 9.79086 21 12V16C21 18.2091 19.2091 20 17 20H7C4.79086 20 3 18.2091 3 16V8C3 5.79086 4.79086 4 7 4H17C17 4 17 8 17 8Z" />,
                shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10zM9 12l2 2 4-4" />,
                help: <path d="M12 16h.01M12 13a2 2 0 0 0 .9-3.42 2 2 0 0 0-2.82 0M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20z" />
            };
            return <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
        };

        const ThemeToggle = ({ darkMode, setDarkMode }) => (
            <button onClick={() => setDarkMode(!darkMode)} className="fixed top-12 right-5 z-50 p-2.5 rounded-xl glass-ui shadow-lg active:scale-90 transition-all">
                <SvgIcon name={darkMode ? "sun" : "moon"} className="w-5 h-5 text-slate-800 dark:text-yellow-400" />
            </button>
        );

        const AppLogo = ({ size = "normal" }) => (
            <div className="flex flex-col items-center animate-enter">
                <div className="relative mb-3">
                    <div className={`${size === 'small' ? 'w-14 h-14' : 'w-20 h-20'} bg-emerald-500 rounded-2xl flex items-center justify-center shadow-xl relative z-20`}>
                        <SvgIcon name="shield" className={size === 'small' ? 'w-7 h-7 text-white' : 'w-10 h-10 text-white'} />
                    </div>
                </div>
                {size !== 'small' && <h1 className="text-3xl font-black text-slate-900 dark:text-white tracking-tighter">AmanPay</h1>}
            </div>
        );

        const WelcomeScreen = ({ onNavigate }) => (
            <div className="min-h-full flex flex-col items-center justify-center p-6 bg-slate-50 dark:bg-slate-950 animate-enter">
                <AppLogo />
                <p className="text-slate-500 dark:text-slate-400 mt-4 mb-10 text-base font-semibold text-center leading-tight">Безопасность и простота <br/>в каждом переводе</p>
                <div className="w-full max-w-xs space-y-3">
                    <button onClick={() => onNavigate('login')} className="w-full bg-emerald-500 text-white font-extrabold py-4 rounded-2xl shadow-lg text-lg active:scale-95 transition-all">Войти</button>
                    <button onClick={() => onNavigate('register')} className="w-full bg-white dark:bg-slate-900 text-slate-900 dark:text-white font-extrabold py-4 rounded-2xl text-lg shadow-sm border border-slate-100 dark:border-slate-800 active:scale-95 transition-all">Регистрация</button>
                    <button onClick={() => onNavigate('instructions')} className="w-full py-2 text-emerald-600 font-bold text-sm active:scale-95 transition-all">Как это работает?</button>
                </div>
            </div>
        );

        const InstructionsScreen = ({ onBack }) => {
            const [role, setRole] = useState('client');
            const steps = {
                client: [
                    { title: "Регистрация", text: "Создайте аккаунт как «Клиент»." },
                    { title: "Ваш ID", text: "ID будет в вашем кабинете." },
                    { title: "Пополнение", text: "Назовите ID любому агенту." }
                ],
                agent: [
                    { title: "Роль Агента", text: "Выберите при регистрации." },
                    { title: "Поиск", text: "Найдите клиента по ID." },
                    { title: "Транзакции", text: "Принимайте или выдавайте." }
                ]
            };
            return (
                <div className="min-h-full p-6 pt-16 bg-slate-50 dark:bg-slate-950 animate-enter">
                    <button onClick={onBack} className="fixed top-10 left-5 p-2.5 rounded-xl glass-ui"><SvgIcon name="back" className="w-5 h-5 dark:text-white"/></button>
                    <h2 className="text-3xl font-black dark:text-white mb-6">Инструкция</h2>
                    <div className="flex p-1 bg-slate-200/50 dark:bg-slate-900 rounded-xl mb-6">
                        <button onClick={() => setRole('client')} className={`flex-1 py-2.5 rounded-lg font-bold text-xs ${role==='client'?'bg-white dark:bg-slate-800 text-emerald-600 shadow-sm':'text-slate-500'}`}>Клиенту</button>
                        <button onClick={() => setRole('agent')} className={`flex-1 py-2.5 rounded-lg font-bold text-xs ${role==='agent'?'bg-white dark:bg-slate-800 text-emerald-600 shadow-sm':'text-slate-500'}`}>Агенту</button>
                    </div>
                    <div className="space-y-3">
                        {steps[role].map((s, i) => (
                            <div key={i} className="glass-ui p-4 rounded-2xl animate-enter" style={{animationDelay:`${i*50}ms`}}>
                                <h4 className="font-extrabold dark:text-white text-base">{s.title}</h4>
                                <p className="text-xs text-slate-500 mt-1">{s.text}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Dashboard = ({ user, onLogout }) => {
            const [balance, setBalance] = useState(user.balance);
            const [history, setHistory] = useState([]);
            const count = useRef(0);

            useEffect(() => {
                const { collections, utils } = window.amanDB;
                const unsub = utils.onSnapshot(utils.doc(collections.users, user.fireId), (s) => s.exists() && setBalance(s.data().balance));
                const unsubH = utils.onSnapshot(collections.txs, (s) => {
                    const data = s.docs.map(d => ({...d.data(), id: d.id})).filter(t => t.userId === user.id).sort((a,b) => b.timestamp - a.timestamp);
                    if (data.length > count.current && count.current > 0) playSound(data[0].type==='deposit'?'receive':'send');
                    setHistory(data); count.current = data.length;
                });
                return () => { unsub(); unsubH(); };
            }, [user.id, user.fireId]);

            return (
                <div className="min-h-full flex flex-col bg-slate-50 dark:bg-slate-950 animate-enter overflow-y-auto">
                    <div className="px-5 pt-12 pb-8">
                        <div className="premium-card p-5 rounded-3xl text-white flex flex-col justify-between h-44">
                            <div className="flex justify-between items-start">
                                <div><p className="text-[10px] opacity-70 font-bold">БАЛАНС</p><h1 className="text-3xl font-black">{formatMoney(balance)}</h1></div>
                                <button onClick={onLogout} className="bg-white/20 p-2.5 rounded-xl"><SvgIcon name="logout" className="w-5 h-5"/></button>
                            </div>
                            <div className="flex justify-between items-end">
                                <p className="text-sm font-bold">{user.name}</p>
                                <SvgIcon name="wallet" className="w-5 h-5 opacity-50"/>
                            </div>
                        </div>
                    </div>
                    <div className="flex-1 px-5 space-y-6">
                        <div className="glass-ui p-6 rounded-3xl text-center shadow-md flex flex-col items-center">
                            <p className="text-[10px] font-bold text-slate-400 uppercase mb-3">Ваш ID</p>
                            <div className="bg-emerald-500/10 px-6 py-3 rounded-xl mb-3"><span className="text-4xl font-black text-emerald-600 tracking-widest">{user.id}</span></div>
                            <p className="text-[10px] text-slate-400 font-bold leading-tight">Покажите ID агенту для <br/>пополнения баланса</p>
                        </div>
                        <div className="pb-8">
                           <h3 className="text-xl font-black dark:text-white mb-4">Активность</h3>
                           <div className="space-y-2.5">
                               {history.map((tx, i) => (
                                   <div key={tx.id || i} className="glass-ui p-3.5 rounded-2xl flex justify-between items-center shadow-sm">
                                       <div className="flex items-center">
                                           <div className={`w-9 h-9 rounded-lg flex items-center justify-center mr-3 ${tx.type==='deposit'?'bg-emerald-100 text-emerald-600':'bg-rose-100 text-rose-600'}`}><SvgIcon name="shield" className="w-4 h-4"/></div>
                                           <div><p className="font-bold dark:text-white text-sm leading-none">{tx.type==='deposit'?'Приход':'Снятие'}</p><p className="text-[9px] text-slate-400 font-bold uppercase mt-1">{tx.agentName}</p></div>
                                       </div>
                                       <p className={`font-black text-base ${tx.type==='deposit'?'text-emerald-600':'dark:text-white'}`}>{tx.type==='deposit'?'+':'-'}{formatMoney(tx.amount)}</p>
                                   </div>
                               ))}
                           </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AgentPanel = ({ agent, onLogout }) => {
            const [searchId, setSearchId] = useState('');
            const [foundUser, setFoundUser] = useState(null);
            const [amount, setAmount] = useState('');
            const [msg, setMsg] = useState(null);

            const handleSearch = async () => {
                if(searchId.length < 4) return;
                const snap = await window.amanDB.utils.getDocs(window.amanDB.collections.users);
                const found = snap.docs.find(d => d.data().id === searchId && d.data().role === 'client');
                if(found) setFoundUser({...found.data(), fireId: found.id});
                else setMsg({type:'error', text:'Клиент не найден'});
            };

            const handleOp = async (type) => {
                const val = parseInt(amount); if(!val) return;
                const { utils, collections } = window.amanDB;
                if(type === 'withdraw' && foundUser.balance < val) return setMsg({type:'error', text:'Лимит счета'});
                try {
                    const newB = type === 'deposit' ? foundUser.balance + val : foundUser.balance - val;
                    await utils.updateDoc(utils.doc(collections.users, foundUser.fireId), { balance: newB });
                    await utils.addDoc(collections.txs, { type, amount: val, userId: foundUser.id, agentName: agent.name, timestamp: Date.now() });
                    playSound(type==='deposit'?'receive':'send');
                    setFoundUser({...foundUser, balance: newB}); setMsg({type:'success', text:'Успешно'}); setAmount('');
                } catch(e) { setMsg({type:'error', text:'Ошибка'}); }
            };

            return (
                <div className="min-h-full flex flex-col bg-slate-900 text-white animate-enter overflow-y-auto">
                    <div className="p-6 pt-12 flex justify-between items-center bg-slate-950/40 rounded-b-3xl">
                        <div><p className="text-emerald-400 text-[9px] font-bold uppercase">АГЕНТ</p><h2 className="text-xl font-black">{agent.name}</h2></div>
                        <button onClick={onLogout} className="bg-slate-800 p-2.5 rounded-xl"><SvgIcon name="logout" className="w-5 h-5"/></button>
                    </div>
                    <div className="p-5 flex-1 flex flex-col items-center">
                        <div className="bg-slate-800/40 p-6 rounded-3xl w-full max-w-[280px] mb-6 text-center">
                            <p className="text-[9px] font-bold text-slate-500 uppercase mb-4">ID Клиента</p>
                            <div className="flex items-center justify-center space-x-3">
                                <input type="number" inputMode="numeric" placeholder="0000" className="w-24 bg-slate-950 border-2 border-slate-700 rounded-xl py-3 text-center text-3xl font-black outline-none focus:border-emerald-500" value={searchId} onChange={e => {
                                    setSearchId(e.target.value.slice(0,4));
                                    if(e.target.value.length === 4) {setFoundUser(null); setTimeout(handleSearch, 100);}
                                }} />
                                <button onClick={handleSearch} className="bg-emerald-500 p-3 rounded-xl shadow-lg active:scale-90"><SvgIcon name="search" className="w-5 h-5"/></button>
                            </div>
                        </div>
                        {msg && <div className={`p-3 rounded-xl mb-4 text-xs font-bold ${msg.type==='success'?'bg-emerald-500/10 text-emerald-400':'bg-rose-500/10 text-rose-400'}`}>{msg.text}</div>}
                        {foundUser && (
                            <div className="bg-white text-slate-900 rounded-3xl p-6 w-full max-w-[320px] shadow-xl animate-enter">
                                <h3 className="text-xl font-black mb-1">{foundUser.name}</h3>
                                <p className="text-slate-400 text-[10px] font-bold uppercase mb-4">Баланс: {formatMoney(foundUser.balance)}</p>
                                <input type="number" inputMode="numeric" placeholder="Сумма" className="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl py-5 text-4xl font-black text-center mb-4 focus:border-emerald-500 outline-none" value={amount} onChange={e => setAmount(e.target.value)} />
                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => handleOp('deposit')} className="bg-emerald-500 text-white py-4 rounded-xl font-black text-xs active:scale-95">Принять</button>
                                    <button onClick={() => handleOp('withdraw')} className="bg-slate-900 text-white py-4 rounded-xl font-black text-xs active:scale-95">Выдать</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('welcome');
            const [user, setUser] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [isAuth, setIsAuth] = useState(false);

            useEffect(() => {
                const init = async () => {
                    if(!window.amanDB) return setTimeout(init, 100);
                    const { auth, utils } = window.amanDB;
                    await utils.signInAnonymously(auth);
                    utils.onAuthStateChanged(auth, (u) => setIsAuth(!!u));
                };
                init();
            }, []);

            if(!isAuth) return <div className="min-h-full bg-slate-50 dark:bg-slate-950 flex items-center justify-center"><div className="w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div></div>;

            return (
                <div className={darkMode ? 'dark h-full' : 'h-full'}>
                    <div className="bg-slate-50 dark:bg-slate-950 h-full relative overflow-hidden">
                        <ThemeToggle darkMode={darkMode} setDarkMode={setDarkMode} />
                        {view === 'welcome' && <WelcomeScreen onNavigate={setView} />}
                        {view === 'instructions' && <InstructionsScreen onBack={() => setView('welcome')} />}
                        {view === 'register' && <Register onBack={() => setView('welcome')} onComplete={(u) => {setUser(u); setView(u.role==='client'?'dash':'agent');}} />}
                        {view === 'login' && <Login onBack={() => setView('welcome')} onComplete={(u) => {setUser(u); setView(u.role==='client'?'dash':'agent');}} />}
                        {view === 'dash' && user && <Dashboard user={user} onLogout={() => setView('welcome')} />}
                        {view === 'agent' && user && <AgentPanel agent={user} onLogout={() => setView('welcome')} />}
                    </div>
                </div>
            );
        };

        const Register = ({ onBack, onComplete }) => {
            const [f, setF] = useState({ name: '', email: '', password: '', role: 'client' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const h = async () => {
                if(!f.name || !f.email || !f.password) return;
                setLoading(true);
                try {
                    const { setDoc, doc, getDocs } = window.amanDB.utils;
                    const id = Math.floor(1000 + Math.random() * 9000).toString();
                    const ref = doc(window.amanDB.collections.users);
                    const u = { ...f, id, balance: 0, fireId: ref.id };
                    await setDoc(ref, u);
                    onComplete(u);
                } catch(e) { setError('Ошибка'); setLoading(false); }
            };
            return (
                <div className="h-full p-8 pt-20 bg-white dark:bg-slate-950 animate-enter overflow-y-auto">
                    <button onClick={onBack} className="fixed top-10 left-5 p-2.5 rounded-xl glass-ui"><SvgIcon name="back" className="w-5 h-5 dark:text-white"/></button>
                    <h2 className="text-3xl font-black dark:text-white mb-6">Регистрация</h2>
                    <div className="space-y-3">
                        <input placeholder="Имя" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 text-sm dark:text-white outline-none" onChange={e => setF({...f, name: e.target.value})} />
                        <input placeholder="Email" type="email" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 text-sm dark:text-white outline-none" onChange={e => setF({...f, email: e.target.value})} />
                        <input placeholder="Пароль" type="password" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-800 text-sm dark:text-white outline-none" onChange={e => setF({...f, password: e.target.value})} />
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={() => setF({...f, role:'client'})} className={`py-3 rounded-xl font-black text-xs ${f.role==='client'?'bg-emerald-500 text-white shadow-md':'bg-slate-100 dark:bg-slate-800 dark:text-white'}`}>Клиент</button>
                            <button onClick={() => setF({...f, role:'agent'})} className={`py-3 rounded-xl font-black text-xs ${f.role==='agent'?'bg-emerald-500 text-white shadow-md':'bg-slate-100 dark:bg-slate-800 dark:text-white'}`}>Агент</button>
                        </div>
                    </div>
                    <button onClick={h} disabled={loading} className="w-full mt-8 bg-emerald-500 text-white py-4 rounded-xl font-black active:scale-95">{loading ? '...' : 'Создать'}</button>
                </div>
            );
        };

        const Login = ({ onBack, onComplete }) => {
            const [f, setF] = useState({ email: '', password: '' });
            const [error, setError] = useState('');
            const h = async () => {
                if(!f.email || !f.password) return;
                const snap = await window.amanDB.utils.getDocs(window.amanDB.collections.users);
                const found = snap.docs.find(d => d.data().email === f.email && d.data().password === f.password);
                if(found) onComplete({...found.data(), fireId: found.id});
                else setError('Ошибка входа');
            };
            return (
                <div className="h-full p-8 pt-20 bg-white dark:bg-slate-950 animate-enter overflow-y-auto">
                    <button onClick={onBack} className="fixed top-10 left-5 p-2.5 rounded-xl glass-ui"><SvgIcon name="back" className="w-5 h-5 dark:text-white"/></button>
                    <h2 className="text-3xl font-black dark:text-white mb-6">Вход</h2>
                    <div className="space-y-3">
                        <input placeholder="Email" type="email" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 text-sm dark:text-white outline-none border-2 border-slate-100 dark:border-slate-800" onChange={e => setF({...f, email: e.target.value})} />
                        <input placeholder="Пароль" type="password" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-900 text-sm dark:text-white outline-none border-2 border-slate-100 dark:border-slate-800" onChange={e => setF({...f, password: e.target.value})} />
                    </div>
                    <button onClick={h} className="w-full mt-8 bg-emerald-500 text-white py-4 rounded-xl font-black active:scale-95">Войти</button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
